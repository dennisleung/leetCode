<!DOCTYPE html>
<body>
<script>

function ListNode(val) {
    this.val = val;
    this.next = null;
}

function TreeNode(val) {
    this.val = val;
    this.left = null;
    this.right = null;
}

const makeLink = (arr)=>{
    if(!arr.length) {
        return null;
    }
    let head = cur = new ListNode();
    arr.forEach((v)=>{
        cur.next = new ListNode(v);
        cur = cur.next;
    });

    return head.next;
}

const makeTree = (arr)=>{
    let head = new TreeNode(arr.shift());
    let nodes = [head];
    while(arr.length) {
        let node = nodes.shift();
        let left = arr.shift();
        let right = arr.shift();
        if(left) {
            node.left = new TreeNode(left);
            nodes.push(node.left);
        }
        if(right) {
            node.right = new TreeNode(right);
            nodes.push(node.right);
        }
    }

    return head;
}

var lowestCommonAncestor = function(root, p, q) {
    let arr = [root]
    let pNode;
    let qNode;
    while(arr.length && (!pNode || !qNode)) {
        let parent = arr.pop();
        let left = parent.left;
        let right = parent.right;
        if(left) {
            left.parent = parent;
            arr.push(left);
        }
        if(right) {
            right.parent = parent;
            arr.push(right);
        }
        if(parent.val==p.val) {
            pNode = parent;
        }
        if(parent.val==q.val) {
            qNode = parent;
        }
    }

    let pMap = {};
    while(pNode) {
        pMap[pNode.val] = pNode;
        pNode = pNode.parent;
    }
    
    while(qNode) {
        if(pMap[qNode.val]) {
            return pMap[qNode.val];
        }
        qNode = qNode.parent;
    }

    return null;
};

console.log(lowestCommonAncestor(makeTree([1, 2, 3]), new TreeNode(2), new TreeNode(1)));

// console.log(hasCycle({
//     val : 1,
//     left : {
//         val : 2,
//         left : {
//             val : 3,
//             left : {
//                 val : 4,
//                 left : {
//                     val : 5
//                 }
//             }
//         }
//     }
// }));

</script>
</body>