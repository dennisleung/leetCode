<!DOCTYPE html>
<body>
<script>

function ListNode(val) {
    this.val = val;
    this.next = null;
}

function TreeNode(val) {
    this.val = val;
    this.left = null;
    this.right = null;
}

const makeLink = (arr)=>{
    if(!arr.length) {
        return null;
    }
    let head = cur = new ListNode();
    arr.forEach((v)=>{
        cur.next = new ListNode(v);
        cur = cur.next;
    });

    return head.next;
}

const makeTree = (arr)=>{
    let head = new TreeNode(arr.shift());
    let nodes = [head];
    while(arr.length) {
        let node = nodes.shift();
        let left = arr.shift();
        let right = arr.shift();
        if(left) {
            node.left = new TreeNode(left);
            nodes.push(node.left);
        }
        if(right) {
            node.right = new TreeNode(right);
            nodes.push(node.right);
        }
    }

    return head;
}

//求所有组合
var getCom = function(len, numOfOne) {
    let result = [];
    if(len<=1) {
        result.push(numOfOne>0?"1":"0");
    }else if(numOfOne<=0) {
        result.push(Array(len+1).join("0"));
    }else if(len<=numOfOne) {
        result.push(Array(numOfOne+1).join("1"));
    }else {
        result = result.concat(getCom(len-1, numOfOne-1).map(v=>"1"+v));
        result = result.concat(getCom(len-1, numOfOne).map(v=>"0"+v));
    }
    return result;
};

function Node(val,isLeaf,topLeft,topRight,bottomLeft,bottomRight) {
    this.val = val;
    this.isLeaf = isLeaf;
    this.topLeft = topLeft;
    this.topRight = topRight;
    this.bottomLeft = bottomLeft;
    this.bottomRight = bottomRight;
};

//我们假设传过来的肯定都是n*n的格子
const isLeaf = function(grid) {
    let first = grid[0][0];
    for(let row of grid) {
        for(let col of row) {
            if(col!=first) {
                return [false];
            }
        }
    }

    return [true, !!first];
};

const sliceGrip = function(grid, rowStart, rowEnd, colStart, colEnd) {
    let result = [];
    for(let i = rowStart; i<rowEnd; i++) {
        result.push(grid[i].slice(colStart, colEnd));
    }

    return result;
}

/**
 * @param {number[][]} grid
 * @return {Node}
 */
 var construct = function(grid) {
    const [_isLeaf, val] = isLeaf(grid);
    const root = new Node(val, _isLeaf);
    if(_isLeaf) {
        return root;
    }

    const rowCount = grid.length;
    const colCount = grid[0].length;
    root.topLeft = construct(sliceGrip(grid, 0, rowCount/2, 0, colCount/2));
    root.topRight = construct(sliceGrip(grid, 0, rowCount/2, colCount/2, colCount));
    root.bottomLeft = construct(sliceGrip(grid, rowCount/2, rowCount, 0, colCount/2));
    root.bottomRight = construct(sliceGrip(grid, rowCount/2, rowCount, colCount/2, colCount));

    return root;
};

const grid = [[1,1,1,1,0,0,0,0],[1,1,1,1,0,0,0,0],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,0,0,0,0],[1,1,1,1,0,0,0,0],[1,1,1,1,0,0,0,0],[1,1,1,1,0,0,0,0]];
console.log(construct(grid));
</script>
</body>